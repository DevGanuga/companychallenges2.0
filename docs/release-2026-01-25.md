# Release Notes - January 25, 2026

## Overview

This release addresses all feedback from COM-38, COM-41, and COM-42 test findings, implementing significant improvements to password UX, URL management, rich text editing, and sprint functionality.

---

## Must Have Fixes (COM-38)

### 1. Password Popup Simplified
**Issue:** Password popup had too much English text  
**Solution:** Streamlined to essentials:
- Title: Just "Password" (was "Password Required")
- Input placeholder: "Password"
- Button: Unlock icon only (no text)
- Removed generic "Contact administrator" text
- Password instructions now display prominently if configured

### 2. Video Thumbnail Resized
**Issue:** Video thumbnail took full-width, pushing out assignment content  
**Solution:** Changed to compact inline button format:
- 48px circular play button + "Watch Video" text
- No longer takes full-width space
- Video still opens in modal when clicked

### 3. Custom URL Field Added
**Issue:** Admins couldn't find where to set custom URLs  
**Solution:** Added prominent "Custom URL" fields:
- Challenge form: `/c/` prefix with input
- Assignment form: `/a/` prefix with input
- Helper text explains format (lowercase, numbers, hyphens)
- Leave empty for auto-generated secure URLs

### 4. Password Persistence Configuration
**Issue:** Passwords unlocked for 24 hours, should be configurable  
**Solution:** Added `password_remember` toggle in assignment form:
- When enabled: Password remembered for browser session
- When disabled: Password required every visit
- Default: Disabled (always require password)

**Database Migration:** `007_assignment_password_remember.sql`

### 5. Legacy URL Support
**Issue:** Need to support `/MMXdXcr` format from legacy app  
**Solution:** Created catch-all route at root level:
- URLs like `/MMXdXcr` automatically redirect to `/c/MMXdXcr` or `/a/MMXdXcr`
- Checks challenges table first, then assignments
- Reserved paths (admin, api, etc.) are excluded
- Existing links from legacy platform now work

### 6. Video Upload MIME Type Fix
**Issue:** "No video with supported format and MIME-type found" error  
**Solution:** Enhanced video support:
- Added MOV (QuickTime) support
- Added OGG video support
- Content-type inference from file extension as fallback
- Updated file input accept attributes

---

## Should Have Improvements (COM-41)

### 7. Link Picker Modal
**Issue:** Linking to assignments/challenges required manual URL copying  
**Solution:** Created searchable link picker in rich editor:
- Search across all assignments and challenges
- Tabs for filtering: All / Assignments / Challenges
- One-click insertion of internal links
- Shows slug preview for each item
- Separate "URL" button for manual entry

### 8. Internal Links Open in Same Window
**Issue:** Links to other assignments opened in new tab  
**Solution:** Internal links (`/a/`, `/c/`) now:
- Open in same window using router.push
- Provide seamless navigation within platform
- External links still open in new tab

### 9. Copy Link Buttons
**Issue:** No easy way to copy assignment/challenge links  
**Solution:** Added copy buttons:
- Assignment library: Copy button in actions column
- Challenge management: Copy button for each assignment row
- Copies full URL to clipboard

### 10. Version Label Free Format
**Issue:** Version label was dropdown with preset options  
**Solution:** Changed to free text input:
- Placeholder: "e.g. Client A, Dutch version, Easy mode..."
- Helper text explains usage
- Any custom label allowed

### 11. Assignment Delete from Library
**Verification:** Server-side logic already correct:
- Checks `assignment_usages` in real-time
- Allows deletion when not used in any challenge
- Shows clear error when still in use

---

## Nice to Have Features (COM-42)

### 12. Color Picker Cross-Browser Fix
**Issue:** Color picker clipped in challenge form  
**Solution:** Fixed overflow and z-index:
- Editor containers now have `relative z-20`
- Form scroll container allows x-overflow
- Color picker renders above other elements

### 13. Archive Functionality
**Issue:** Only delete option, no way to temporarily hide assignments  
**Solution:** Added archive feature:
- "Archive" button in assignment library
- "Restore" button for archived assignments
- Archived assignments hidden by default but recoverable

**Database Migration:** `008_assignment_archive.sql`

### 14. Sprint-as-Container Architecture
**Issue:** Sprints should behave like assignments with nested content  
**Solution:** Expanded sprint model:
- Added subtitle field
- Added rich text description (description_html)
- Added cover image support
- Added optional password protection
- Added URL slug for sprint pages
- Updated sprint form with all new fields

**Database Migration:** `009_sprint_container.sql`

### 15. HTML Source Editing
**Issue:** Can't edit raw HTML in rich text editors  
**Solution:** Added "View Source" toggle:
- Code icon button in toolbar
- Shows raw HTML in editable textarea
- Apply/Cancel buttons
- Syntax highlighting via monospace font

---

## Database Migrations

Three new migrations were created and executed:

```sql
-- 007_assignment_password_remember.sql
ALTER TABLE assignments ADD COLUMN IF NOT EXISTS password_remember BOOLEAN DEFAULT false;

-- 008_assignment_archive.sql
ALTER TABLE assignments ADD COLUMN IF NOT EXISTS archived_at TIMESTAMPTZ DEFAULT NULL;
CREATE INDEX IF NOT EXISTS idx_assignments_archived ON assignments (archived_at);

-- 009_sprint_container.sql
ALTER TABLE sprints ADD COLUMN IF NOT EXISTS slug TEXT;
ALTER TABLE sprints ADD COLUMN IF NOT EXISTS subtitle TEXT;
ALTER TABLE sprints ADD COLUMN IF NOT EXISTS description_html TEXT;
ALTER TABLE sprints ADD COLUMN IF NOT EXISTS cover_image_url TEXT;
ALTER TABLE sprints ADD COLUMN IF NOT EXISTS password_hash TEXT;
ALTER TABLE sprints ADD COLUMN IF NOT EXISTS position INTEGER DEFAULT 0;
CREATE UNIQUE INDEX IF NOT EXISTS idx_sprints_slug ON sprints (slug) WHERE slug IS NOT NULL;
```

---

## Files Modified

### Components
- `components/public/password-gate.tsx` - Simplified UI
- `components/admin/assignment-form.tsx` - Custom URL, password_remember toggle
- `components/admin/challenge-form.tsx` - Custom URL field, z-index fixes
- `components/admin/assignment-list.tsx` - Archive/restore buttons
- `components/admin/assignment-picker.tsx` - Free text version label
- `components/admin/sprint-form.tsx` - New container fields
- `components/ui/inline-rich-editor.tsx` - Link picker, HTML source toggle
- `components/ui/link-picker.tsx` - New component
- `components/public/content-renderer.tsx` - Internal link handling
- `app/admin/challenges/[id]/page-client.tsx` - Copy link button
- `app/(public)/a/[slug]/page-client.tsx` - Compact video button

### Actions
- `lib/actions/assignments.ts` - Archive/unarchive functions
- `lib/actions/sprints.ts` - New container fields, password hashing
- `lib/actions/public.ts` - password_remember support
- `lib/actions/upload.ts` - Extended video MIME types

### Types
- `lib/types/database.ts` - New fields for Assignment and Sprint

### Routes
- `app/[legacySlug]/page.tsx` - New legacy URL support

---

## Summary

| Category | Issues Addressed | Status |
|----------|-----------------|--------|
| Must Have (COM-38) | 6 | ✅ All Complete |
| Should Have (COM-41) | 5 | ✅ All Complete |
| Nice to Have (COM-42) | 4 | ✅ All Complete |
| **Total** | **15** | **✅ All Complete** |

---

## Testing Checklist

- [ ] Password popup shows simplified UI
- [ ] Video thumbnail is compact inline button
- [ ] Custom URL fields visible in challenge/assignment forms
- [ ] Password remember toggle works
- [ ] Legacy URLs redirect correctly
- [ ] Video uploads work with MOV files
- [ ] Link picker opens and works
- [ ] Internal links open in same window
- [ ] Copy link buttons work
- [ ] Version label accepts free text
- [ ] Archive/restore functionality works
- [ ] Color picker not clipped
- [ ] Sprint form shows new fields
- [ ] HTML source toggle works

---

## Deployment Notes

1. **Database:** Run all three migrations in order (007, 008, 009)
2. **Build:** `npm run build` completes successfully
3. **Environment:** No new environment variables required
